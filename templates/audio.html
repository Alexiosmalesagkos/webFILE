<!DOCTYPE html><html><head>
    <meta charset="UTF-8"><title>{{ name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="{{ url_for('index', static="audio.ico") }}">
    <style>
        body { display: flex; justify-content: center;
            align-items: center; height: 90vh;
            background-color: #000; flex-direction: column; }
        .flex { display: flex; justify-content: center; }
        h2 { text-align: center; color: #FFFFFF; }
</style></head><body>
    <h2>{{ name }}</h2><br>
    <div id="audio-container">
        <audio controls autoplay id="audio" data-mode="0" onended="handleAudioEnded()" onvolumechange="saveVolume()">
            <source src="{{ url_for('index', raw=path) }}" type="audio/mp3">
    </audio></div>
    <div class="flex">
        <button onclick="prev()">Prev</button> &nbsp;&nbsp;&nbsp;
        <button id="mode" onclick="chMode()">1</button>
        &nbsp;&nbsp;&nbsp;<button onclick="next()">Next</button>
    </div><br><br><br> <script>
        var audio = document.getElementById("audio");
        var mode = document.getElementById("mode");
        var storedMode = localStorage.getItem("audioMode");
        var storedVolume = localStorage.getItem("audioVolume"); 
        if (storedMode !== null) { audio.setAttribute("data-mode", storedMode); updateModeButton(); }
        if (storedVolume !== null) { audio.volume = parseFloat(storedVolume); }
        function updateModeButton() {
            var currentMode = parseInt(audio.getAttribute("data-mode"));
            if (currentMode === 0) { mode.textContent = "1"; }
            else if (currentMode === 1) { mode.textContent = "»"; }
            else if (currentMode === 2) { mode.textContent = "↻"; } }
        function next() {
            localStorage.setItem("audioMode", audio.getAttribute("data-mode"));
            localStorage.setItem("audioVolume", audio.volume.toString());
            window.location.href = '{{ nxt }}'; }
        function prev() {
            localStorage.setItem("audioMode", audio.getAttribute("data-mode"));
            localStorage.setItem("audioVolume", audio.volume.toString());
            window.location.href = '{{ prev }}'; }
        function chMode() {
            var currentMode = parseInt(audio.getAttribute("data-mode"));
            if (currentMode === 0) { audio.setAttribute("data-mode", 1); mode.textContent = "»"; }
            else if (currentMode === 1) { audio.setAttribute("data-mode", 2); mode.textContent = "↻"; }
            else if (currentMode === 2) { audio.setAttribute("data-mode", 0); mode.textContent = "1"; } }  
        function handleAudioEnded() {
            var currentMode = parseInt(audio.getAttribute("data-mode"));
            if (currentMode === 1) {
                localStorage.setItem("audioMode", audio.getAttribute("data-mode"));
                localStorage.setItem("audioVolume", audio.volume.toString());
                window.location.href = '{{ nxt }}'; }
            else if (currentMode === 2) { audio.currentTime = 0; audio.play(); } }
        function saveVolume() { localStorage.setItem("audioVolume", audio.volume.toString()); }
</script></body></html>

